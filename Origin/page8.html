<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page 8 (Final & Fixed) - 集采前后医疗费用变化</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        :root {
            --bg-color: #FFFBF0;
            --font-color: #4A4A4A;
            --font-color-light: #7A7A7A;
            /* --- 全新高级调色板 --- */
            --color-decrease: #65BB5D; /* 使用您之前提供的绿色代表降低 */
            --color-increase: #D9534F; /* 明确的红色表示增长 */
            --border-color: rgba(0, 0, 0, 0.08);
            --panel-bg: rgba(255, 255, 255, 0.65);
            --font-family-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
        }
        html, body { height: 100%; width: 100%; overflow: hidden; background-color: var(--bg-color); font-family: var(--font-family-main); color: var(--font-color); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        .page-container { display: grid; grid-template-columns: 120px 1fr 320px; grid-template-rows: 100px 1fr 80px; grid-template-areas: "header header header" "sidebar main infobar" "sidebar footer footer"; height: 100vh; padding: 2.5vw; gap: 2vw; }
        
        .page-header { grid-area: header; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; opacity: 0; animation: fadeIn 0.8s 0.2s ease-out forwards; }
        .main-title { font-size: 3.2vw; font-weight: 900; letter-spacing: 0.05em; }
        .page-number { font-size: 1.2vw; font-weight: 400; color: var(--font-color-light); }
        .page-number span { font-weight: 700; color: var(--color-decrease); }

        .sidebar { grid-area: sidebar; display: flex; flex-direction: column; gap: 15px; opacity: 0; animation: slideInLeft 0.8s 0.6s forwards; }
        .sidebar-item { display: flex; align-items: center; justify-content: center; height: 80px; border: 1px solid var(--border-color); border-radius: 12px; font-size: 1.5vw; font-weight: 500; cursor: pointer; transition: all 0.3s ease; background: var(--panel-bg); backdrop-filter: blur(12px); box-shadow: 0 4px 20px rgba(0,0,0,0.04); }
        .sidebar-item:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.08); border-color: var(--color-decrease); }
        .sidebar-item.active { background-color: var(--font-color); color: var(--bg-color); border-color: var(--font-color); }

        .info-panel { grid-area: infobar; padding: 30px; border-radius: 12px; background: var(--panel-bg); backdrop-filter: blur(12px); box-shadow: 0 4px 20px rgba(0,0,0,0.04); border: 1px solid var(--border-color); opacity: 0; animation: slideInRight 0.8s 0.6s forwards; position: relative; }
        .info-panel::before { content: ''; position: absolute; left: 30px; top: 35px; width: 5px; height: 2.5vh; background-color: var(--color-decrease); border-radius: 3px; }
        .info-panel h3 { font-size: 1.5vw; margin-bottom: 25px; font-weight: 600; padding-left: 20px; }
        .info-panel p { font-size: 1vw; line-height: 2.2; font-weight: 300; margin-bottom: 1.5em; }
        .info-panel strong { font-weight: 600; }

        .main-content { grid-area: main; display: flex; flex-direction: column; opacity: 0; animation: fadeIn 0.8s 0.8s forwards; }
        .chart-controls { display: flex; justify-content: center; margin-bottom: 15px; gap: 10px; }
        .control-btn { padding: 10px 25px; font-size: 1vw; border: 1px solid var(--border-color); background: transparent; color: var(--font-color); border-radius: 25px; cursor: pointer; transition: all 0.3s ease; }
        .control-btn:hover { background-color: rgba(0,0,0,0.03); border-color: var(--font-color); }
        .control-btn.active { background-color: var(--font-color); color: var(--bg-color); border-color: var(--font-color); }
        #chart-container { flex-grow: 1; width: 100%; height: 100%; }

        .page-footer { grid-area: footer; display: flex; align-items: center; justify-content: center; }
        .chart-title { font-size: 1.2vw; font-weight: 500; color: var(--font-color-light); text-align: center; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>
    <div class="page-container">
        <header class="page-header">
            <div class="main-title">降低患者负担</div>
            <div class="page-number">Page<span>8</span></div>
        </header>
        
        <aside class="sidebar">
            <div class="sidebar-item active">患者</div>
            <div class="sidebar-item">企业</div>
            <div class="sidebar-item">社会</div>
            <div class="sidebar-item">其他</div>
        </aside>

        <main class="main-content">
            <div class="chart-controls">
                <button id="show-change-rate" class="control-btn active">费用变化率</button>
                <button id="show-composition" class="control-btn">费用构成流转</button>
            </div>
            <div id="chart-container"></div>
        </main>

        <aside class="info-panel">
            <h3>图表解读</h3>
            <div id="info-text">
                 <p><strong>降费成效显著：</strong>药品相关费用降幅最为明显，直接体现了集采政策的核心成效。图表清晰展示了各类费用的<strong>相对变化幅度</strong>。</p>
                 <p><strong>结构腾笼换鸟：</strong>部分体现医务价值的项目（如耗材）费用呈<strong>正增长</strong>，反映了医疗费用结构的优化调整，而非一味压缩。</p>
            </div>
        </aside>

        <footer class="page-footer">
            <div id="chart-title-container" class="chart-title"></div>
        </footer>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const sourceData = [
            { category: '综合服务类', before_avg: 1876.66, before_ratio: 10.92, after_avg: 1973.92, after_ratio: 11.93 },
            { category: '治疗类', before_avg: 4191.03, before_ratio: 24.38, after_avg: 3786.21, after_ratio: 22.88 },
            { category: '诊断类', before_avg: 2095.45, before_ratio: 12.19, after_avg: 1991.67, after_ratio: 12.04 },
            { category: '康复类', before_avg: 39.61, before_ratio: 0.23, after_avg: 28.93, after_ratio: 0.17 },
            { category: '中医类', before_avg: 765.42, before_ratio: 4.45, after_avg: 702.46, after_ratio: 4.25 },
            { category: '药品类', before_avg: 5127.07, before_ratio: 29.82, after_avg: 4651.43, after_ratio: 28.11 },
            { category: '西药类', before_avg: 4101.31, before_ratio: 23.86, after_avg: 3801.12, after_ratio: 22.97 },
            { category: '中药类', before_avg: 1025.76, before_ratio: 5.97, after_avg: 850.31, after_ratio: 5.14 },
            { category: '血液及血液制品类', before_avg: 263.26, before_ratio: 1.53, after_avg: 242.18, after_ratio: 1.46 },
            { category: '耗材类', before_avg: 2730.57, before_ratio: 15.88, after_avg: 3136.03, after_ratio: 18.95 },
            { category: '其他类', before_avg: 102.94, before_ratio: 0.60, after_avg: 34.59, after_ratio: 0.21 }
        ];

        const chartDom = document.getElementById('chart-container');
        const myChart = echarts.init(chartDom);
        const chartTitleContainer = document.getElementById('chart-title-container');
        
        const colors = { decrease: '#65BB5D', increase: '#D9534F' };
        const areaColors = ['#5B8FA8', '#6EA4B8', '#81B9C8', '#94CDD8', '#A7E2E8', '#F2C6C4', '#EAAFAE', '#E39897', '#DC8181', '#E07A5F', '#D06C53'];

        // --- 数据预处理 ---
        const changeRateData = sourceData.map(item => ({
            category: item.category,
            value: item.before_avg === 0 ? 0 : ((item.after_avg - item.before_avg) / item.before_avg) * 100,
            before_avg: item.before_avg,
            after_avg: item.after_avg,
        })).sort((a, b) => a.value - b.value);

        // --- 配置项1：费用变化率 (已修正) ---
        const optionChangeRate = {
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'shadow' },
                formatter: function (params) {
                    const data = params[0].data;
                    return `${data.category}<br/>
                            变化率: <strong>${data.value.toFixed(1)}%</strong><br/>
                            绝对值: ¥${data.before_avg.toFixed(2)} → ¥${data.after_avg.toFixed(2)}`;
                }
            },
            grid: { left: '3%', right: '10%', bottom: '3%', containLabel: true },
            xAxis: { type: 'value', name: '变化率 (%)', axisLabel: { formatter: '{value}%' } },
            yAxis: { type: 'category', data: changeRateData.map(item => item.category) },
            series: [{
                type: 'bar',
                label: {
                    show: true,
                    position: 'right',
                    formatter: (params) => `${params.value.toFixed(1)}%`,
                    fontSize: '1vw',
                    color: '#333'
                },
                data: changeRateData.map(item => ({
                    value: item.value, // **关键修正: 确保这是数值(Number)**
                    category: item.category,
                    before_avg: item.before_avg,
                    after_avg: item.after_avg,
                    itemStyle: {
                        color: item.value > 0 ? colors.increase : colors.decrease
                    }
                }))
            }]
        };

        // --- 配置项2：费用构成流转 (经验证) ---
        const optionComposition = {
            color: areaColors,
            tooltip: { trigger: 'axis', formatter: function(params) {
                let result = params[0].name + '<br/>';
                params.forEach(p => {
                    result += `${p.marker} ${p.seriesName}: ${p.value.toFixed(2)}%<br/>`;
                });
                return result;
            }},
            legend: { top: 'center', right: 20, orient: 'vertical', icon: 'circle' },
            grid: { left: '3%', right: '180px', bottom: '3%', containLabel: true },
            xAxis: { type: 'category', boundaryGap: false, data: ['集采前', '集采后'] },
            yAxis: { type: 'value', name: '构成比 (%)', max: 100, axisLabel: { formatter: '{value}%' } },
            series: sourceData.map(item => ({
                name: item.category,
                type: 'line',
                stack: 'Total',
                smooth: true,
                lineStyle: { width: 0 },
                showSymbol: false,
                areaStyle: { opacity: 0.85 },
                emphasis: { focus: 'series' },
                data: [item.before_ratio, item.after_ratio]
            }))
        };
        
        function renderChangeRateChart() {
            myChart.setOption(optionChangeRate, true);
            chartTitleContainer.innerText = '图五：集采前后各项费用均值变化率对比';
            document.getElementById('show-change-rate').classList.add('active');
            document.getElementById('show-composition').classList.remove('active');
        }
        
        function renderCompositionChart() {
            myChart.setOption(optionComposition, true);
            chartTitleContainer.innerText = '图五：集采前后费用构成流转对比';
            document.getElementById('show-composition').classList.add('active');
            document.getElementById('show-change-rate').classList.remove('active');
        }

        document.getElementById('show-change-rate').addEventListener('click', renderChangeRateChart);
        document.getElementById('show-composition').addEventListener('click', renderCompositionChart);

        renderChangeRateChart();
        window.addEventListener('resize', () => myChart.resize());
    });
</script>
</body>
</html>